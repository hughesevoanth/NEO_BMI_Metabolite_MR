---
title: "NEO BMI-Metabolite Exploring Obs Point Estimate Results"
author: "David Hughes"
date: "13/12/2022"
output: 
  pdf_document:
    number_sections: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set( echo = TRUE, error = FALSE, warning = FALSE, message = FALSE)

source("LOAD.R")
library(patchwork)
```

## Load point estimates

```{r}
w = which(par_data[,1] == "results_dir")
resultsdir = par_data[w,2]

f = paste0(resultsdir, "obs_tsls_estimates_Dec12_2022.Rdata")
load( f)

## long format data
f = paste0(resultsdir, "obs_tsls_estimates_long_Dec12_2022.Rdata")
load( file = f)

```

## load sensitivity data

```{r}
## sensitivity results
w = which(par_data[,1] == "results_dir")
resultsdir = par_data[w,2]
f = paste0(resultsdir, "tables/Dec12_2022_wNEO_SENSITIVITY_estimates.txt")
wNEO_sensitivity = read.table(f, header = TRUE, sep = "\t", as.is = TRUE)

## long format of sensitivity 
wNEO_sensitivity_long = obsmr_2_longformat(data = wNEO_sensitivity, 
                               pop_id = "wNEO_sa", 
                               alpha = 0.05/43, 
                               sandwich_estimates = FALSE)
```

## add sensitivity data to list

```{r}
obs_tsls_est[["wNEO_sa"]] = wNEO_sensitivity

obs_tsls_est_long[["wNEO_sa"]] = wNEO_sensitivity_long
```

## add annotation to the results data frames

```{r}
for(i in 1:length(obs_tsls_est) ){
  obs_tsls_est[[i]] = cbind(obs_tsls_est[[i]], study_data$feature_anno[, c("dietary_state","raw.label","class","subclass", "derived_features")] )
}
```


```{r}
names(obs_tsls_est)
```



# Observational Results

## Cross-sectional Sex specific analysis


```{r}
sexdata = data.frame(outcome = obs_tsls_est$wNEO_male$outcome,
                     male = obs_tsls_est$wNEO_male$Obs_beta,
                     maleP = obs_tsls_est$wNEO_male$Obs_P,
                     female = obs_tsls_est$wNEO_female$Obs_beta,
                     femaleP = obs_tsls_est$wNEO_female$Obs_P, 
                     state = obs_tsls_est$wNEO_female$dietary_state)
###
sexdata$rawlabel = study_data$feature_anno$raw.label
sexdata$class = study_data$feature_anno$class
###
sexdata$sig = sapply(1:nrow(sexdata), function(i){
  if(sexdata$maleP[i] < 0.05/43 & sexdata$femaleP[i] < 0.05/43){
    out = "both"
  } else {
    if(sexdata$maleP[i] < 0.05/43 & sexdata$femaleP[i] > 0.05/43){
      out = "male"
    } else {
      if(sexdata$maleP[i] > 0.05/43 & sexdata$femaleP[i] < 0.05/43){
        out = "female"
      } else {
        out = "neither"
      }
    }
  }
})

## correlation
a = cor.test(sexdata$female, sexdata$male)
## colors
pcol = RColorBrewer::brewer.pal(4, "Set1")

## plot
library(ggrepel)
##
(male_female_scatter_plot = sexdata %>% ggplot(aes(x = female, y = male)) +
  geom_hline(yintercept = 0, color = "grey70", linetype = "dashed") +
  geom_vline(xintercept = 0,color = "grey70", linetype = "dashed") +
  geom_abline(slope = 1, intercept = 0, linetype = "dotted",color = "grey45") +
  geom_point(aes(color = sig, shape = state), size = 3, alpha = 0.6) +
  scale_color_brewer(palette = "Set1") +
  scale_shape_manual(values = c(19,15,17) ) +
  geom_smooth(method = "lm", formula = y~x, color = "black") +
  geom_text_repel( data = sexdata %>% filter(sig == "female" & female < 0 & male > 0), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = -0.03, nudge_y = 0.01 ) +
  geom_text_repel( data = sexdata %>% filter(sig == "male" & female < 0 & male > 0), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[3], nudge_x = -0.01, nudge_y = 0.03 ) +
  geom_text_repel( data = sexdata %>% filter(sig == "male" & female > 0 & male < 0), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[3], nudge_x = 0.01, nudge_y = -0.03 ) +
  labs(x = "female cross-sectional effect estimates", 
       y = "male cross-sectional effect estimates",
       color = "association") +
  annotate("text", x = 0.0625, y = -0.095, label = paste0("Pearson's r = ", round(a$estimate, d = 3) ) ) +
  theme_bw()
)

```


### Comparison with Wurtz et al

```{r}
## define data dir
w = which(par_data[, 1] == "data_dir")
data_dir = par_data[w, 2]
## define file
f = paste0(data_dir, "Wurtz/Wurtz_Edited_Data.txt")
wurtz = read.table(f, header = TRUE, sep = "\t")
colnames(wurtz) = paste0("wurtz_", colnames(wurtz))
colnames(wurtz)[1] = "wurtz_longname"
## match to my fasting data
ftemp = obs_tsls_est$wNEO %>% filter(dietary_state == "fasting")
ftemp$metids = metids

m = match(ftemp$metids, wurtz$wurtz_ID)
tempd = cbind(ftemp[, c(1,2,17,18,20,67,68,70)], wurtz[m,])
rm(ftemp)
neo_wurtz = na.omit(tempd)

m = match(neo_wurtz$outcome, study_data$feature_anno$ids)
neo_wurtz = cbind(neo_wurtz, study_data$feature_anno[m, c("raw.label", "label", "label.no.units", "class", "subclass")])

dim(neo_wurtz)
```
```{r}
x = neo_wurtz$wurtz_MR_beta / neo_wurtz$wurtz_conversion_factor
a = cor.test( neo_wurtz$MR_beta, x, method = "pearson")
a
```


```{r}
x = neo_wurtz$wurtz_obs_beta / neo_wurtz$wurtz_conversion_factor
a = cor.test(neo_wurtz$Obs_beta, x, method = "pearson")
# cor.test(neo_wurtz$Obs_beta, x, method = "spearman")

pdata = cbind( neo_wurtz[, c("outcome","Obs_beta")] , 
               Obs_LCI = neo_wurtz$Obs_beta - (1.96 * neo_wurtz$Obs_se),
               Obs_UCI = neo_wurtz$Obs_beta + (1.96 * neo_wurtz$Obs_se),
               Obs_P = neo_wurtz$Obs_P,
               wurtz_obs_beta = neo_wurtz$wurtz_obs_beta / neo_wurtz$wurtz_conversion_factor, 
               wurtz_obs_LCI = neo_wurtz$wurtz_obs_LCI / neo_wurtz$wurtz_conversion_factor, 
               wurtz_obs_UCI = neo_wurtz$wurtz_obs_UCI / neo_wurtz$wurtz_conversion_factor, 
               wurtz_obs_P = neo_wurtz$wurtz_obs_P
               )

#pdata$sig_both = ifelse(pdata$Obs_P < 0.05/43 & pdata$wurtz_obs_P < 0.05/100, "sig_both", "not")
pdata$sig = sapply(1:nrow(pdata), function(i){
  if(pdata$Obs_P[i] < 0.05/43 & pdata$wurtz_obs_P[i] < 0.05/100){
    out = "both"
  } else {
    if(pdata$Obs_P[i] < 0.05/43 & pdata$wurtz_obs_P[i] > 0.05/100){
      out = "NEO"
    } else {
      if(pdata$Obs_P[i] > 0.05/43 & pdata$wurtz_obs_P[i] < 0.05/100){
        out = "Wurtz"
      } else {
        out = "neither"
      }
    }
  }
  return(out)
})
pdata$sig = factor(pdata$sig, levels = c("NEO","Wurtz","both","neither"))

## Z-test for difference among estimates

pcol = RColorBrewer::brewer.pal(4, "Set1")
###
( NEO_Wurtz_scatterplot = pdata %>% ggplot(aes(x = wurtz_obs_beta, y = Obs_beta) ) + 
  geom_abline(slope = 1, intercept = 0, linetype = "dotted", color = "grey45") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey70") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey70") +
  geom_point(aes(color = sig ), size = 3) + 
  # geom_errorbar(aes( xmin  = wurtz_obs_LCI, xmax  = wurtz_obs_UCI, width = 0.15), color = "grey") +
  # geom_errorbar(aes( ymin  = Obs_LCI, ymax  = Obs_UCI, width = 0.15), color = "grey") +
  scale_color_brewer(palette = "Set1") +
  geom_smooth(method = "lm", formula = y~x, color = "black") +
  labs(x = "Wurtz et al effect estimate", y = "Hughes et al effect estimate", color = "association") +
  annotate("text",x = 0.065, y = -0.09, label = paste0( "Pearson's r = ", round(a$estimate, d = 2)  ) ) +
  geom_text_repel( data = pdata %>% filter(sig == "both" & wurtz_obs_beta > 0 & Obs_beta < 0), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[3], nudge_x = 0.00, nudge_y = -0.02 ) +
  geom_text_repel( data = pdata %>% filter(sig == "both" & wurtz_obs_beta < 0.05 & Obs_beta > 0.05), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[3], nudge_x = -0.001, nudge_y = 0,
                  max.overlaps = 15) +
   geom_text_repel( data = pdata %>% filter(sig == "Wurtz" & wurtz_obs_beta > 0 & Obs_beta < 0), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = 0.01, nudge_y = -0.005, 
                  max.overlaps = 15 ) +
   geom_text_repel( data = pdata %>% filter(sig == "Wurtz" & wurtz_obs_beta < 0 ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = -0.01, nudge_y = 0., 
                  max.overlaps = 15) +
  geom_text_repel( data = pdata %>% filter(sig == "NEO"  ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[1], nudge_x = -0.01, nudge_y = 0, 
                  max.overlaps = 15 ) +
  theme_bw()
)

```



## Postpranial vs Fasting


### correlation between fasting and postprandial

```{r}
fdata = obs_tsls_est$wNEO %>% filter(dietary_state == "fasting") %>% 
  dplyr::select("outcome","Obs_beta","Obs_se","Obs_P", "class", "subclass", "raw.label")
colnames(fdata)[2:4] = paste0("fasting_", colnames(fdata)[2:4])
fdata$metids = metids
##
pdata = obs_tsls_est$wNEO %>% filter(dietary_state == "postprandial") %>% 
  dplyr::select("Obs_beta","Obs_se","Obs_P")
colnames(pdata) = paste0("postprandial_", colnames(pdata))
pdata$metids = metids
##
rdata = obs_tsls_est$wNEO %>% filter(dietary_state == "response") %>% 
  dplyr::select("Obs_beta","Obs_se","Obs_P")
colnames(rdata) = paste0("response_", colnames(rdata))
rdata$metids = metids

df = left_join(fdata, pdata, by = "metids")
df = left_join(df, rdata, by = "metids")
```

## Z-test for difference among estimates

```{r}
z = t( sapply(1:nrow(df), function(i){
  ztest(df$fasting_Obs_beta[i], df$fasting_Obs_se[i], 
        df$postprandial_Obs_beta[i], df$postprandial_Obs_se[i])
}) )

df$ztestP = ifelse( z[,2] < 0.05, "< 0.05", "> 0.05")
df$ztestP = ifelse( z[,2] < 0.05/229, "< 0.05/229", df$ztestP)
df$ztestP = factor(df$ztestP, levels = c("> 0.05","< 0.05","< 0.05/229"))
```

```{r}
df$association = NULL
for(i in 1:nrow(df)){
  if(df$fasting_Obs_P[i] > 0.05/43 & df$postprandial_Obs_P[i] > 0.05/43){
    out = "neither"
  } else {
    if(df$fasting_Obs_P[i] < 0.05/43 & df$postprandial_Obs_P[i] > 0.05/43){
      out = "fasting"
    } else {
      if(df$fasting_Obs_P[i] > 0.05/43 & df$postprandial_Obs_P[i] < 0.05/43){
        out = "postprandial"
      } else {
        if(df$fasting_Obs_P[i] < 0.05/43 & df$postprandial_Obs_P[i] < 0.05/43){
          out = "both"
        }
      }
    }
  }
  df$association[i] = out
}
df$association = factor(df$association, levels = c("fasting","postprandial","both","neither"))

```


```{r}
a = cor.test(df$fasting_Obs_beta, df$postprandial_Obs_beta)
a = paste0("Pearson's r = ", round(a$estimate, d=3) )
```




```{r}
library(ggrepel)

( fast_post_obs_scatter_plot = df %>% ggplot(aes(x = fasting_Obs_beta, y = postprandial_Obs_beta)) +
  geom_abline(intercept = 0, slope = 1, linetype = "dotted", color = "grey40") + 
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey40") +
  geom_smooth(method = "lm", formula = y~x, color = "black") +
  geom_point(aes(color = association, shape = ztestP), size = 3, alpha = 0.7) +
  scale_color_brewer(palette = "Set1", type = "seq") +
  scale_shape_manual(values = c(19, 15, 17)) +
  theme_bw() +
  labs(x = "fasting cross-sectional estimate", 
       y = "postprandial cross-sectional estimate",
       shape = paste0("estimates diff.") ) +
  annotate("text", x = 0.06, y = -0.085, label = a) +
  geom_text_repel( data = df %>% filter(ztestP == "< 0.05/229" & 
                                          postprandial_Obs_beta < fasting_Obs_beta), 
                  aes(label=metids, color = association), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  nudge_x = 0.005, nudge_y = -0.001 ) +
  geom_text_repel( data = df %>% filter(ztestP == "< 0.05/229" & 
                                          postprandial_Obs_beta > fasting_Obs_beta), 
                  aes(label=metids, color = association), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  nudge_x = -0.008, nudge_y = 0.01 )
  )
```



```{r, fig.width = 4, fig.height=6}
( PLOT1 = male_female_scatter_plot / NEO_Wurtz_scatterplot / fast_post_obs_scatter_plot + 
  plot_annotation(tag_levels = "A") )
```


# Comparing observational and MR Results

## Overall Scatter Plot

```{r, fig.width = 5, fig.height = 5}
#### define the plot data
temp = obs_tsls_est$wNEO
temp$dietary_state = factor(temp$dietary_state, levels = unique(temp$dietary_state) )
## correlation
PearsonR = cor.test(temp$Obs_beta, temp$MR_beta)$estimate
PearsonR = formatC(PearsonR, digits = 3)

#### difference between point estimates
z = t( sapply(1:nrow(temp), function(i){
  ztest(beta1 = temp[i,"Obs_beta"], se1 = temp[i,"Obs_se"] , 
        beta2 = temp[i,"MR_beta"] , se2 = temp[i,"MR_se"] )  
}) )
temp$ztest_P = z[,2]
w = which( z[,2]< 0.05 )
q = which( z[,2]< 0.05/nrow(z) )
temp$sig_dif = "P>0.05"
temp$sig_dif[w] = "P<0.05"
temp$sig_dif[q] = "P<0.05/603"

### sort the sig_dif plot order
temp$sig_dif = factor(temp$sig_dif, levels = c("P>0.05","P<0.05","P<0.05/603"))
## Define colors
pcol = RColorBrewer::brewer.pal(3, "Set1")[3:1]
  
###
obs_mr_scatter = temp %>% ggplot(aes(x = Obs_beta, y = MR_beta)) +
  geom_abline(intercept = 0, slope = 1, color = "grey45", linetype = "dashed", size = 1.25) +
  geom_vline(xintercept = 0, color = "grey45", linetype = "dotted", size = 1.25) +
  geom_hline(yintercept = 0, color = "grey45", linetype = "dotted", size = 1.25) +
  geom_smooth( method = "lm", formula = y ~ x , color = "black", size = 1.5) +
  geom_point( aes(shape = as.factor(sig_dif), color = dietary_state ), 
              alpha = 0.8, size = 3) +
  ggrepel::geom_text_repel( data = filter(temp, sig_dif != "P>0.05" & Obs_beta > MR_beta), 
                  aes(label=outcome, color = dietary_state), 
                  min.segment.length = 0,
                  box.padding = 0.4,
                  nudge_x = 0.015,
                  nudge_y = -0.01
                   ) +
  ggrepel::geom_text_repel( data = filter(temp, sig_dif != "P>0.05" & Obs_beta < MR_beta), 
                  aes(label=outcome, color = dietary_state), 
                  min.segment.length = 0,
                  box.padding = 0.4,
                  nudge_x = -0.005,
                  nudge_y = 0.01
                   ) +
  # scale_color_brewer(palette="Set1") +
  scale_color_manual(values = pcol) +
  scale_shape_manual(values = c(1, 19)) +
  labs(shape = paste0("estimates\ndifferent between\nobs and MR"), 
       x = "observational estimates", y = "MR estimates",
       color = "dietary state",
       subtitle = paste0( "Pearson's r = ", PearsonR ) ) +
  theme_bw() 

obs_mr_scatter

```

## save correlation scatter plot to file

```{r}
f = paste0(resultsdir, "figures/wNEO_obs_mr_total_scatter.pdf")
pdf(file = f, width = 7, height = 5)
obs_mr_scatter
dev.off()
```



## Obs and MR correlation scatter plot by dietary state

```{r, fig.width = 10, fig.height = 15}
## Correlation estimates
ds = levels(temp$dietary_state)
PR = sapply(ds, function(s){
  w = which(temp$dietary_state == s)
  out = cor.test(temp$Obs_beta[w], temp$MR_beta[w])$estimate
  out = formatC(out, digits = 3)
  return(out)
})
PR = data.frame(dietary_state = ds, PearsonR = paste0("Pearson's r = ", PR), Obs_beta = 0.035, MR_beta = -0.12)
PR$dietary_state = factor(PR$dietary_state, levels = ds)

### PLOT
obs_mr_scatter_byDS = temp %>% ggplot(aes(x = Obs_beta, y = MR_beta)) +
  geom_smooth( method = "lm", formula = y ~ x , color = "black", size = 1.5) +
  geom_abline(intercept = 0, slope = 1, color = "grey45", linetype = "dotted") +
  geom_vline(xintercept = 0, color = "grey70", linetype = "dashed") +
  geom_hline(yintercept = 0, color = "grey70", linetype = "dashed") +
  geom_point( aes(shape = as.factor(sig_dif), color = dietary_state ), 
              alpha = 0.8, size = 3) +
  ggrepel::geom_text_repel( data = filter(temp, sig_dif != "P>0.05" ), 
                  aes(label=outcome), 
                  min.segment.length = 0.2,
                  box.padding = 0.7
                   ) +
  # ggrepel::geom_text_repel( data = temp %>% 
  #                             filter(dietary_state == "response" & 
  #                                      Obs_beta > 0.015  & MR_beta > 0.02), 
  #                 aes(label=outcome, color = dietary_state), 
  #                 min.segment.length = 0.2,
  #                 box.padding = 0.5, nudge_x = 0.01, nudge_y = 0.02
  #                  ) +
  # ggrepel::geom_text_repel( data = temp %>% 
  #                             filter(dietary_state == "response" & 
  #                                      Obs_beta < -0.03  & MR_beta < -0.03),
  #                 aes(label=outcome, color = dietary_state),
  #                 min.segment.length = 0.3,
  #                 box.padding = 0.5
  #                  ) +
  scale_color_brewer(palette="Set1") +
  scale_color_manual(values = pcol) +
  scale_shape_manual(values = c(1, 19)) +
  labs(shape = paste0("estimates diff."), 
       x = "observational estimates", y = "MR estimates",
       color = "dietary state" ) +
  theme_bw() +
  facet_wrap( ~ dietary_state, ncol = 1 ) +
  geom_text(data = PR, aes(label = PearsonR), size = 4 )
  # expand_limits(x=c(-0.1,0.1), y=c(-0.1,0.1)) 

obs_mr_scatter_byDS

```


```{r, fig.width = 10, fig.height = 8}
MF3 = (PLOT1 | obs_mr_scatter_byDS) + plot_annotation(tag_levels = "A")
```

## save correlation scatter plot to file

```{r}
f = paste0(resultsdir, "figures/MansucriptFigure3.pdf")
pdf(file = f, width = 13, height = 12)
MF3
dev.off()
```

```{r}
x = neo_wurtz$wurtz_MR_beta / neo_wurtz$wurtz_conversion_factor
a = cor.test(neo_wurtz$MR_beta, x, method = "pearson")
# cor.test(neo_wurtz$Obs_beta, x, method = "spearman")

pdata = cbind( neo_wurtz[, c("outcome","MR_beta")] , 
               MR_LCI = neo_wurtz$MR_beta - (1.96 * neo_wurtz$MR_se),
               MR_UCI = neo_wurtz$MR_beta + (1.96 * neo_wurtz$MR_se),
               MR_P = neo_wurtz$MR_P,
               wurtz_MR_beta = neo_wurtz$wurtz_MR_beta / neo_wurtz$wurtz_conversion_factor, 
               wurtz_MR_LCI = neo_wurtz$wurtz_MR_LCI / neo_wurtz$wurtz_conversion_factor, 
               wurtz_MR_UCI = neo_wurtz$wurtz_MR_UCI / neo_wurtz$wurtz_conversion_factor, 
               wurtz_MR_P = neo_wurtz$wurtz_MR_P
               )

#pdata$sig_both = ifelse(pdata$Obs_P < 0.05/43 & pdata$wurtz_obs_P < 0.05/100, "sig_both", "not")
pdata$sig = sapply(1:nrow(pdata), function(i){
  if(pdata$MR_P[i] < 0.05/43 & pdata$wurtz_MR_P[i] < 0.05/100){
    out = "both"
  } else {
    if(pdata$MR_P[i] < 0.05/43 & pdata$wurtz_MR_P[i] > 0.05/100){
      out = "NEO"
    } else {
      if(pdata$MR_P[i] > 0.05/43 & pdata$wurtz_MR_P[i] < 0.05/100){
        out = "Wurtz"
      } else {
        out = "neither"
      }
    }
  }
  return(out)
})
pdata$sig = factor(pdata$sig, levels = c("NEO","Wurtz","both","neither"))

## Z-test for difference among estimates

pcol = RColorBrewer::brewer.pal(4, "Set1")
###
( NEO_Wurtz_MR_scatterplot = pdata %>% ggplot(aes(x = wurtz_MR_beta, y = MR_beta) ) + 
  geom_abline(slope = 1, intercept = 0, linetype = "dotted", color = "grey45") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey70") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey70") +
  geom_point(aes(color = sig ), size = 3) + 
  # geom_errorbar(aes( xmin  = wurtz_obs_LCI, xmax  = wurtz_obs_UCI, width = 0.15), color = "grey") +
  # geom_errorbar(aes( ymin  = Obs_LCI, ymax  = Obs_UCI, width = 0.15), color = "grey") +
  scale_color_brewer(palette = "Set1") +
  geom_smooth(method = "lm", formula = y~x, color = "black") +
  labs(x = "Wurtz et al MR effect estimate", 
       y = "Hughes et al MR effect estimate", color = "association") +
  annotate("text",x = 0.045, y = -0.09, label = paste0( "Pearson's r = ", round(a$estimate, d = 2)  ) ) +
  geom_text_repel( data = pdata %>% filter(sig == "both" ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[3], nudge_x = 0.009, nudge_y = 0.005 ) +
   geom_text_repel( data = pdata %>% filter(sig == "Wurtz" & wurtz_MR_beta < 0  ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = 0, nudge_y = 0.01, 
                  max.overlaps = 15 ) +
    geom_text_repel( data = pdata %>% filter(sig == "Wurtz" & MR_beta > 0.05  ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = -0.04, nudge_y = 0, 
                  max.overlaps = 15 ) +
    geom_text_repel( data = pdata %>% filter(sig == "Wurtz" & MR_beta < 0.05  ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[2], nudge_x = 0.01, nudge_y = -0.01, 
                  max.overlaps = 15 ) +
  geom_text_repel( data = pdata %>% filter(sig == "NEO" ), 
                  aes(label=outcome), 
                  min.segment.length = 0,
                  box.padding = 0.25, 
                  color = pcol[1], nudge_x = 0, nudge_y = -0.002, 
                  max.overlaps = 15 ) +
  theme_bw()
)

```

```{r}
f = paste0(resultsdir, "figures/Wurtz_vs_NEO_fasting_MR.pdf")
pdf(file = f, width = 8, height = 6)
NEO_Wurtz_MR_scatterplot
dev.off()
```



